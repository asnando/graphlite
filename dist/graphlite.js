!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.graphlite=t():e.graphlite=t()}(window,function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=12)}([function(e,t,n){const r=n(13),o=n(14),s=n(2),i=n(5),a=n(15),c=n(9),l=n(16),u=n(10),h=n(17),p=n(6),f=n(18),g=n(19),d=n(20),b=n(7),y=n(21),m=n(22),v=n(23),w=n(24),_=n(25),$=n(26),O=n(27),j=n(28),T=n(29),N=n(31),E=n(32),x=n(33),A=n(34);e.exports={jtree:r,createHashCode:o,type:s,isArray:i,isBoolean:a,isNumber:c,isString:l,isObject:u,isFunction:h,isDef:p,quote:f,pbcopy:g,xtend:d,keys:b,defaults:y,pickBy:m,equals:v,copy:w,jpretty:_,omit:$,get:O,set:j,glob:T,query:N,toArray:E,pair:x,hash:A}},function(e,t,n){e.exports={debug:n(36),log:n(37),alert:n(48),warn:n(49),error:n(50),success:n(51)}},function(e,t){e.exports=function(e){return Object.prototype.toString.call(e).replace(/^\[object (.+)\]$/,"$1").toLowerCase()}},function(e,t,n){"use strict";(function(t){const r=n(39),o=n(40),s=n(45).stdout,i=n(46),a="win32"===t.platform&&!(Object({WEBPACK_ENV:!0}).TERM||"").toLowerCase().startsWith("xterm"),c=["ansi","ansi","ansi256","ansi16m"],l=new Set(["gray"]),u=Object.create(null);function h(e,t){t=t||{};const n=s?s.level:0;e.level=void 0===t.level?n:t.level,e.enabled="enabled"in t?t.enabled:e.level>0}function p(e){if(!this||!(this instanceof p)||this.template){const t={};return h(t,e),t.template=function(){const e=[].slice.call(arguments);return function(e,t){if(!Array.isArray(t))return[].slice.call(arguments,1).join(" ");const n=[].slice.call(arguments,2),r=[t.raw[0]];for(let e=1;e<t.length;e++)r.push(String(n[e-1]).replace(/[{}\\]/g,"\\$&")),r.push(String(t.raw[e]));return i(e,r.join(""))}.apply(null,[t.template].concat(e))},Object.setPrototypeOf(t,p.prototype),Object.setPrototypeOf(t.template,t),t.template.constructor=p,t.template}h(this,e)}a&&(o.blue.open="[94m");for(const e of Object.keys(o))o[e].closeRe=new RegExp(r(o[e].close),"g"),u[e]={get(){const t=o[e];return g.call(this,this._styles?this._styles.concat(t):[t],this._empty,e)}};u.visible={get(){return g.call(this,this._styles||[],!0,"visible")}},o.color.closeRe=new RegExp(r(o.color.close),"g");for(const e of Object.keys(o.color.ansi))l.has(e)||(u[e]={get(){const t=this.level;return function(){const n={open:o.color[c[t]][e].apply(null,arguments),close:o.color.close,closeRe:o.color.closeRe};return g.call(this,this._styles?this._styles.concat(n):[n],this._empty,e)}}});o.bgColor.closeRe=new RegExp(r(o.bgColor.close),"g");for(const e of Object.keys(o.bgColor.ansi)){if(l.has(e))continue;u["bg"+e[0].toUpperCase()+e.slice(1)]={get(){const t=this.level;return function(){const n={open:o.bgColor[c[t]][e].apply(null,arguments),close:o.bgColor.close,closeRe:o.bgColor.closeRe};return g.call(this,this._styles?this._styles.concat(n):[n],this._empty,e)}}}}const f=Object.defineProperties(()=>{},u);function g(e,t,n){const r=function(){return function(){const e=arguments,t=e.length;let n=String(arguments[0]);if(0===t)return"";if(t>1)for(let r=1;r<t;r++)n+=" "+e[r];if(!this.enabled||this.level<=0||!n)return this._empty?"":n;const r=o.dim.open;a&&this.hasGrey&&(o.dim.open="");for(const e of this._styles.slice().reverse())n=(n=e.open+n.replace(e.closeRe,e.open)+e.close).replace(/\r?\n/g,`${e.close}$&${e.open}`);return o.dim.open=r,n}.apply(r,arguments)};r._styles=e,r._empty=t;const s=this;return Object.defineProperty(r,"level",{enumerable:!0,get:()=>s.level,set(e){s.level=e}}),Object.defineProperty(r,"enabled",{enumerable:!0,get:()=>s.enabled,set(e){s.enabled=e}}),r.hasGrey=this.hasGrey||"gray"===n||"grey"===n,r.__proto__=f,r}Object.defineProperties(p.prototype,u),e.exports=p(),e.exports.supportsColor=s,e.exports.default=e.exports}).call(this,n(38))},function(e,t,n){const r=n(47);e.exports=function(e){let t="\n";for(let e=0;e<r+1;e++)t+=" ";e=[e=e.replace(/\n/g,t)];for(let t=0;t<r-1;t++)e.unshift(" ");return e.join(" ")}},function(e,t,n){const r=n(2);e.exports=function(e){return"array"===r(e)}},function(e,t){e.exports=function(e){return null!=e}},function(e,t){e.exports=function(e){return Object.keys(e)}},function(e,t){e.exports={DEFAULT_ROW_NAME:"response",DEFAULT_OBJECT_TYPE:"object",DEFAULT_ROW_COUNT_NAME:"count",DEFAULT_PAGE_DATA_LIMIT:100,DEFAULT_OPTIONS_PAGE:1,DEFAULT_OBJECT_RESPONSE_NAME:"rows",DEFAULT_ASSOCIATION_JOIN_TYPE:"inner",DEFAULT_COUNT_OBJECT_RESPONSE_NAME:"count",DEFAULT_TOTAL_COUNT_OBJECT_RESPONSE_NAME:"total",DEFAULT_CONNECTION_PROVIDER_QUERY_RUNNER_NAME:"run"}},function(e,t,n){const r=n(2);e.exports=function(e){return"number"===r(e)}},function(e,t,n){const r=n(2);e.exports=function(e){return"object"===r(e)}},function(e,t,n){var r=n(43),o={};for(var s in r)r.hasOwnProperty(s)&&(o[r[s]]=s);var i=e.exports={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};for(var a in i)if(i.hasOwnProperty(a)){if(!("channels"in i[a]))throw new Error("missing channels property: "+a);if(!("labels"in i[a]))throw new Error("missing channel labels property: "+a);if(i[a].labels.length!==i[a].channels)throw new Error("channel and label counts mismatch: "+a);var c=i[a].channels,l=i[a].labels;delete i[a].channels,delete i[a].labels,Object.defineProperty(i[a],"channels",{value:c}),Object.defineProperty(i[a],"labels",{value:l})}i.rgb.hsl=function(e){var t,n,r=e[0]/255,o=e[1]/255,s=e[2]/255,i=Math.min(r,o,s),a=Math.max(r,o,s),c=a-i;return a===i?t=0:r===a?t=(o-s)/c:o===a?t=2+(s-r)/c:s===a&&(t=4+(r-o)/c),(t=Math.min(60*t,360))<0&&(t+=360),n=(i+a)/2,[t,100*(a===i?0:n<=.5?c/(a+i):c/(2-a-i)),100*n]},i.rgb.hsv=function(e){var t,n,r,o,s,i=e[0]/255,a=e[1]/255,c=e[2]/255,l=Math.max(i,a,c),u=l-Math.min(i,a,c),h=function(e){return(l-e)/6/u+.5};return 0===u?o=s=0:(s=u/l,t=h(i),n=h(a),r=h(c),i===l?o=r-n:a===l?o=1/3+t-r:c===l&&(o=2/3+n-t),o<0?o+=1:o>1&&(o-=1)),[360*o,100*s,100*l]},i.rgb.hwb=function(e){var t=e[0],n=e[1],r=e[2];return[i.rgb.hsl(e)[0],100*(1/255*Math.min(t,Math.min(n,r))),100*(r=1-1/255*Math.max(t,Math.max(n,r)))]},i.rgb.cmyk=function(e){var t,n=e[0]/255,r=e[1]/255,o=e[2]/255;return[100*((1-n-(t=Math.min(1-n,1-r,1-o)))/(1-t)||0),100*((1-r-t)/(1-t)||0),100*((1-o-t)/(1-t)||0),100*t]},i.rgb.keyword=function(e){var t=o[e];if(t)return t;var n,s,i,a=1/0;for(var c in r)if(r.hasOwnProperty(c)){var l=r[c],u=(s=e,i=l,Math.pow(s[0]-i[0],2)+Math.pow(s[1]-i[1],2)+Math.pow(s[2]-i[2],2));u<a&&(a=u,n=c)}return n},i.keyword.rgb=function(e){return r[e]},i.rgb.xyz=function(e){var t=e[0]/255,n=e[1]/255,r=e[2]/255;return[100*(.4124*(t=t>.04045?Math.pow((t+.055)/1.055,2.4):t/12.92)+.3576*(n=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92)+.1805*(r=r>.04045?Math.pow((r+.055)/1.055,2.4):r/12.92)),100*(.2126*t+.7152*n+.0722*r),100*(.0193*t+.1192*n+.9505*r)]},i.rgb.lab=function(e){var t=i.rgb.xyz(e),n=t[0],r=t[1],o=t[2];return r/=100,o/=108.883,n=(n/=95.047)>.008856?Math.pow(n,1/3):7.787*n+16/116,[116*(r=r>.008856?Math.pow(r,1/3):7.787*r+16/116)-16,500*(n-r),200*(r-(o=o>.008856?Math.pow(o,1/3):7.787*o+16/116))]},i.hsl.rgb=function(e){var t,n,r,o,s,i=e[0]/360,a=e[1]/100,c=e[2]/100;if(0===a)return[s=255*c,s,s];t=2*c-(n=c<.5?c*(1+a):c+a-c*a),o=[0,0,0];for(var l=0;l<3;l++)(r=i+1/3*-(l-1))<0&&r++,r>1&&r--,s=6*r<1?t+6*(n-t)*r:2*r<1?n:3*r<2?t+(n-t)*(2/3-r)*6:t,o[l]=255*s;return o},i.hsl.hsv=function(e){var t=e[0],n=e[1]/100,r=e[2]/100,o=n,s=Math.max(r,.01);return n*=(r*=2)<=1?r:2-r,o*=s<=1?s:2-s,[t,100*(0===r?2*o/(s+o):2*n/(r+n)),100*((r+n)/2)]},i.hsv.rgb=function(e){var t=e[0]/60,n=e[1]/100,r=e[2]/100,o=Math.floor(t)%6,s=t-Math.floor(t),i=255*r*(1-n),a=255*r*(1-n*s),c=255*r*(1-n*(1-s));switch(r*=255,o){case 0:return[r,c,i];case 1:return[a,r,i];case 2:return[i,r,c];case 3:return[i,a,r];case 4:return[c,i,r];case 5:return[r,i,a]}},i.hsv.hsl=function(e){var t,n,r,o=e[0],s=e[1]/100,i=e[2]/100,a=Math.max(i,.01);return r=(2-s)*i,n=s*a,[o,100*(n=(n/=(t=(2-s)*a)<=1?t:2-t)||0),100*(r/=2)]},i.hwb.rgb=function(e){var t,n,r,o,s,i,a,c=e[0]/360,l=e[1]/100,u=e[2]/100,h=l+u;switch(h>1&&(l/=h,u/=h),r=6*c-(t=Math.floor(6*c)),0!=(1&t)&&(r=1-r),o=l+r*((n=1-u)-l),t){default:case 6:case 0:s=n,i=o,a=l;break;case 1:s=o,i=n,a=l;break;case 2:s=l,i=n,a=o;break;case 3:s=l,i=o,a=n;break;case 4:s=o,i=l,a=n;break;case 5:s=n,i=l,a=o}return[255*s,255*i,255*a]},i.cmyk.rgb=function(e){var t=e[0]/100,n=e[1]/100,r=e[2]/100,o=e[3]/100;return[255*(1-Math.min(1,t*(1-o)+o)),255*(1-Math.min(1,n*(1-o)+o)),255*(1-Math.min(1,r*(1-o)+o))]},i.xyz.rgb=function(e){var t,n,r,o=e[0]/100,s=e[1]/100,i=e[2]/100;return n=-.9689*o+1.8758*s+.0415*i,r=.0557*o+-.204*s+1.057*i,t=(t=3.2406*o+-1.5372*s+-.4986*i)>.0031308?1.055*Math.pow(t,1/2.4)-.055:12.92*t,n=n>.0031308?1.055*Math.pow(n,1/2.4)-.055:12.92*n,r=r>.0031308?1.055*Math.pow(r,1/2.4)-.055:12.92*r,[255*(t=Math.min(Math.max(0,t),1)),255*(n=Math.min(Math.max(0,n),1)),255*(r=Math.min(Math.max(0,r),1))]},i.xyz.lab=function(e){var t=e[0],n=e[1],r=e[2];return n/=100,r/=108.883,t=(t/=95.047)>.008856?Math.pow(t,1/3):7.787*t+16/116,[116*(n=n>.008856?Math.pow(n,1/3):7.787*n+16/116)-16,500*(t-n),200*(n-(r=r>.008856?Math.pow(r,1/3):7.787*r+16/116))]},i.lab.xyz=function(e){var t,n,r,o=e[0];t=e[1]/500+(n=(o+16)/116),r=n-e[2]/200;var s=Math.pow(n,3),i=Math.pow(t,3),a=Math.pow(r,3);return n=s>.008856?s:(n-16/116)/7.787,t=i>.008856?i:(t-16/116)/7.787,r=a>.008856?a:(r-16/116)/7.787,[t*=95.047,n*=100,r*=108.883]},i.lab.lch=function(e){var t,n=e[0],r=e[1],o=e[2];return(t=360*Math.atan2(o,r)/2/Math.PI)<0&&(t+=360),[n,Math.sqrt(r*r+o*o),t]},i.lch.lab=function(e){var t,n=e[0],r=e[1];return t=e[2]/360*2*Math.PI,[n,r*Math.cos(t),r*Math.sin(t)]},i.rgb.ansi16=function(e){var t=e[0],n=e[1],r=e[2],o=1 in arguments?arguments[1]:i.rgb.hsv(e)[2];if(0===(o=Math.round(o/50)))return 30;var s=30+(Math.round(r/255)<<2|Math.round(n/255)<<1|Math.round(t/255));return 2===o&&(s+=60),s},i.hsv.ansi16=function(e){return i.rgb.ansi16(i.hsv.rgb(e),e[2])},i.rgb.ansi256=function(e){var t=e[0],n=e[1],r=e[2];return t===n&&n===r?t<8?16:t>248?231:Math.round((t-8)/247*24)+232:16+36*Math.round(t/255*5)+6*Math.round(n/255*5)+Math.round(r/255*5)},i.ansi16.rgb=function(e){var t=e%10;if(0===t||7===t)return e>50&&(t+=3.5),[t=t/10.5*255,t,t];var n=.5*(1+~~(e>50));return[(1&t)*n*255,(t>>1&1)*n*255,(t>>2&1)*n*255]},i.ansi256.rgb=function(e){if(e>=232){var t=10*(e-232)+8;return[t,t,t]}var n;return e-=16,[Math.floor(e/36)/5*255,Math.floor((n=e%36)/6)/5*255,n%6/5*255]},i.rgb.hex=function(e){var t=(((255&Math.round(e[0]))<<16)+((255&Math.round(e[1]))<<8)+(255&Math.round(e[2]))).toString(16).toUpperCase();return"000000".substring(t.length)+t},i.hex.rgb=function(e){var t=e.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!t)return[0,0,0];var n=t[0];3===t[0].length&&(n=n.split("").map(function(e){return e+e}).join(""));var r=parseInt(n,16);return[r>>16&255,r>>8&255,255&r]},i.rgb.hcg=function(e){var t,n=e[0]/255,r=e[1]/255,o=e[2]/255,s=Math.max(Math.max(n,r),o),i=Math.min(Math.min(n,r),o),a=s-i;return t=a<=0?0:s===n?(r-o)/a%6:s===r?2+(o-n)/a:4+(n-r)/a+4,t/=6,[360*(t%=1),100*a,100*(a<1?i/(1-a):0)]},i.hsl.hcg=function(e){var t=e[1]/100,n=e[2]/100,r=1,o=0;return(r=n<.5?2*t*n:2*t*(1-n))<1&&(o=(n-.5*r)/(1-r)),[e[0],100*r,100*o]},i.hsv.hcg=function(e){var t=e[1]/100,n=e[2]/100,r=t*n,o=0;return r<1&&(o=(n-r)/(1-r)),[e[0],100*r,100*o]},i.hcg.rgb=function(e){var t=e[0]/360,n=e[1]/100,r=e[2]/100;if(0===n)return[255*r,255*r,255*r];var o,s=[0,0,0],i=t%1*6,a=i%1,c=1-a;switch(Math.floor(i)){case 0:s[0]=1,s[1]=a,s[2]=0;break;case 1:s[0]=c,s[1]=1,s[2]=0;break;case 2:s[0]=0,s[1]=1,s[2]=a;break;case 3:s[0]=0,s[1]=c,s[2]=1;break;case 4:s[0]=a,s[1]=0,s[2]=1;break;default:s[0]=1,s[1]=0,s[2]=c}return o=(1-n)*r,[255*(n*s[0]+o),255*(n*s[1]+o),255*(n*s[2]+o)]},i.hcg.hsv=function(e){var t=e[1]/100,n=t+e[2]/100*(1-t),r=0;return n>0&&(r=t/n),[e[0],100*r,100*n]},i.hcg.hsl=function(e){var t=e[1]/100,n=e[2]/100*(1-t)+.5*t,r=0;return n>0&&n<.5?r=t/(2*n):n>=.5&&n<1&&(r=t/(2*(1-n))),[e[0],100*r,100*n]},i.hcg.hwb=function(e){var t=e[1]/100,n=t+e[2]/100*(1-t);return[e[0],100*(n-t),100*(1-n)]},i.hwb.hcg=function(e){var t=e[1]/100,n=1-e[2]/100,r=n-t,o=0;return r<1&&(o=(n-r)/(1-r)),[e[0],100*r,100*o]},i.apple.rgb=function(e){return[e[0]/65535*255,e[1]/65535*255,e[2]/65535*255]},i.rgb.apple=function(e){return[e[0]/255*65535,e[1]/255*65535,e[2]/255*65535]},i.gray.rgb=function(e){return[e[0]/100*255,e[0]/100*255,e[0]/100*255]},i.gray.hsl=i.gray.hsv=function(e){return[0,0,e[0]]},i.gray.hwb=function(e){return[0,100,e[0]]},i.gray.cmyk=function(e){return[0,0,0,e[0]]},i.gray.lab=function(e){return[e[0],0,0]},i.gray.hex=function(e){var t=255&Math.round(e[0]/100*255),n=((t<<16)+(t<<8)+t).toString(16).toUpperCase();return"000000".substring(n.length)+n},i.rgb.gray=function(e){return[(e[0]+e[1]+e[2])/3/255*100]}},function(e,t,n){const r=n(0),o=n(35),s=n(53),i=(n(1),n(8)),{DEFAULT_ROW_NAME:a,DEFAULT_ROW_COUNT_NAME:c,DEFAULT_OBJECT_RESPONSE_NAME:l,DEFAULT_COUNT_OBJECT_RESPONSE_NAME:u,DEFAULT_TOTAL_COUNT_OBJECT_RESPONSE_NAME:h,DEFAULT_CONNECTION_PROVIDER_QUERY_RUNNER_NAME:p,DEFAULT_OPTIONS_PAGE:f}=i,g={connection:null,schemas:[],queries:[],options:{}};e.exports=class{constructor(e){Object.assign(this,g),this.connection=r.defaults(e.connection,this.connection),this.schemas=r.defaults(e.schemas,this.schemas,e=>e.map(e=>this.defineSchema(e))),r.isFunction(e.associations)&&e.associations(function(e){const t={};return e.forEach(e=>t[e.name]=e),t}(this.schemas)),this.queries=r.defaults(e.queries,this.queries,e=>e.map(e=>this.defineQuery(e)))}_schemaProvider(e){return this.schemas.find(t=>t.name===e)}_mergeOptions(e={},t={}){return r.pickBy(r.xtend({},e,{page:t.page||f,size:t.size,withCount:t.withCount}))}getQueryByName(e){return this.queries.find(t=>t.name===e)}_executeQueryOnDatabase(e){return new Promise((t,n)=>{const o=p;return this.connection?r.isFunction(this.connection[o])?this.connection[o](e).then(t).catch(n):n(`Unknown "${o}" method on the connection provider instance!`):n("There is no database connection to run the query!")})}_parseRowsFromDatabase(e,t){return e=e.map(e=>JSON.parse(e[t])),t===c?e[0]:e}_translateRowsToObject(e,t){return{[t]:e}}_executeQueryWithOptions(e,t={}){return new Promise((n,o)=>{const s=this.getQueryByName(e);return s?[()=>{const e=s.buildQuery(t);return this._executeQueryOnDatabase(e).then(e=>this._parseRowsFromDatabase(e,a)).then(e=>s.parseRows(e)).then(e=>this._translateRowsToObject(e,l))},r.isBoolean(t.count)&&!t.count||1!==t.page?null:e=>{const n=s.buildCountQuery(t);return this._executeQueryOnDatabase(n).then(e=>this._parseRowsFromDatabase(e,c)).then(e=>this._translateRowsToObject(e,h)).then(t=>r.xtend(t,e))}].reduce((e,t)=>e.then(t),Promise.resolve()).then(e=>({[h]:e[h],[u]:e[l].length,[l]:e[l]})).then(e=>n(e)).catch(o):o(`Undefined ${e} query!`)})}findOne(e,t={},n={}){return n.size=1,this._executeQueryWithOptions(e,this._mergeOptions(t,n))}findAll(e,t={},n={}){return this._executeQueryWithOptions(e,this._mergeOptions(t,n))}defineSchema(e,t){const n=this._schemaProvider.bind(this);t=r.isObject(e)?e:t,e=r.isObject(e)?e.name:e;const s=new o(e,t,n);return this.schemas.push(s),s}defineQuery(e,t){const n=this._schemaProvider.bind(this);t=r.isObject(e)?e:t,e=r.isObject(e)?e.name:e,delete t.name;const o=new s(e,t,n);return this.queries.push(o),o}}},function(e,t,n){const r=n(5),o=n(9),s=n(10);e.exports=function e(t,n,i,a,c,l){i=i||"$",l=l||{},"function"==typeof n&&(l=n(t,i,l,a,c)),r(t)?t.forEach((r,o)=>{e(r,n,i.concat("#").concat(o),t,i,l)}):s(t)&&Object.keys(t).forEach(r=>{o(r)||e(t[r],n,i.concat(".").concat(r),t,i,l)})}},function(e,t){e.exports=function e(){let t=Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15);return/^\d/.test(t)?e():t}},function(e,t,n){n(2);e.exports=function(e){return"boolean"==typeof e}},function(e,t,n){const r=n(2);e.exports=function(e){return"string"===r(e)}},function(e,t,n){const r=n(2);e.exports=function(e){return"function"===r(e)}},function(e,t){e.exports=function(e){return`'${e}'`}},function(e,t,n){e.exports=function(e){}},function(e,t){e.exports=function(){var e=[].slice.call(arguments),t=e.shift()||{};return e.forEach(function(e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])}),t}},function(e,t,n){const r=n(6);e.exports=function(e,t,n){return r(e)&&r(n)?n(e):r(e)?e:t}},function(e,t,n){const r=n(6);e.exports=function(e){for(key in e)r(e[key])||delete e[key];return e}},function(e,t){e.exports=function(e,t){return e===t}},function(e,t){e.exports=function(e){return{...e}}},function(e,t){e.exports=function(e,t=2){return JSON.stringify(e,null,t)}},function(e,t){e.exports=function(e,t){return t.forEach(t=>delete e[t]),e}},function(e,t){e.exports=function(e,t){return t.split(".").reduce((e,t)=>e&&"undefined"!==e[t]?e[t]:void 0,e)}},function(e,t){e.exports=function(e,t,n){for(var r=e,o=t.split("."),s=o.length,i=0;i<s-1;i++){var a=o[i];r[a]||(r[a]={}),r=r[a]}r[o[s-1]]=n}},function(e,t,n){const r=n(7),o=n(30);e.exports=function(e){const t={a:"[AÁÀÂÄÃªaáàâäã]",e:"[EÉÈÊËeéèêë]",i:"[IÍÌÎÏiíìîï]",o:"[OÓÒÔÖÕºoóòôöõ]",u:"[UÚÙÛÜuúùûü]",c:"[CÇcç]"};e=o(e);const n=r(t);return"*"+e.split("").map(e=>n.includes(e)?t[e]:`[${e.toUpperCase()}${e}]`).join("")+"*"}},function(e,t,n){const r=n(7);e.exports=function(e){const t={a:["á","à","â","","ã","ª"],e:["é","è","ê",""],i:["í","ì","î",""],o:["ó","ò","ô","","õ","º"],u:["ú","ù","û",""],c:["ç"]};e=e.toLowerCase();const n=r(t);for(let r=0;r<e.length;r++){const o=e.charAt(r);n.forEach(n=>{t[n].includes(o)&&(e=e.replace(e.charAt(r),n))})}return e}},function(e,t,n){e.exports=function(e){return e}},function(e,t,n){const r=n(5);e.exports=function(e){return void 0===e?[]:r(e)?e:[e]}},function(e,t){e.exports=function(e,t=!1,n){return e.reduce((e,t,n)=>(n%2?e[e.length-1].push(t):e.push([t]),e),[]).map(e=>(!t&&e.length<2&&e.push(n),e))}},function(e,t){e.exports=function(e=15){for(var t="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=0;r<e;r++)t+=n.charAt(Math.floor(Math.random()*n.length));return t}},function(e,t,n){n(1);const r=n(0),o=n(52);e.exports=class{constructor(e,t,n){if(this.schemaProvider=n,this.name=e,this.tableName=t.tableName,this.hash=r.createHashCode(),this.properties=this._createSchemaProperties(t.properties),this.has={},this.belongs={},!this.tableName)throw new Error(`Missing table name definition for "${this.name}" schema.`)}_createSchemaProperties(e){if(!(e=r.keys(e).map(t=>this._createSchemaProperty(t,e[t]))).find(e=>"primaryKey"===e.type))throw new Error(`Missing primary key definition for "${this.name}" schema.`);return e}_createSchemaProperty(e,t){const n=r.isString(t)?t:t.type?t.type:"default",o=r.pickBy({name:e,type:n,alias:t.alias,resolver:t.resolve,join:t.join,parser:t.parser});return"primaryKey"===n&&(this.primaryKey=o.name),o}_createAssociation(e,t,n){const r=/^has/.test(n),s=(/^belongs/.test(n),r?this:e),i=r?e:this,a={schemaFrom:this.name,schemaTo:e.name,targetHash:i.hash,targetTable:i.tableName,targetKey:i.primaryKey,sourceHash:s.hash,sourceTable:s.tableName,sourceKey:s.primaryKey,foreignTable:t.foreignTable,foreignKey:t.foreignKey,useKey:t.useKey,useSourceKey:t.useSourceKey,useTargetKey:t.useTargetKey,type:t.type,objectType:/many/i.test(n)?"array":"object",using:(t.using||[]).map(e=>this.schemaProvider(e)),associationType:n};return new o(a)}hasMany(e,t={}){this.has[e.name]=this._createAssociation(e,t,"hasMany")}hasOne(e,t={}){this.has[e.name]=this._createAssociation(e,t,"hasOne")}belongsTo(e,t={}){this.belongs[e.name]=this._createAssociation(e,t,"belongsTo")}belongsToMany(e,t={}){this.belongs[e.name]=this._createAssociation(e,t,"belongsToMany")}haveAssociationWith(e){const t=this._getAssociationKeys(),n=e._getAssociationKeys();return t.includes(e.name)||n.includes(this.name)}getAssociationOptionsWith(e){let t=this._getAssociation(e,this);if(!t)throw new Error(`No association found between "${e.name}" and "${this.name}".`);return t=t.using.length?this._resolveAssociationTree(e,this,t):t}_getAssociation(e,t){return e.has[t.name]||e.belongs[t.name]||t.has[e.name]||t.belongs[e.name]}_resolveAssociationTree(e,t,n){return[e,...n.using,t].reduce((e,t,n,r)=>{if(n){const o=r[n-1],s=this._getAssociation(o,t);return e.concat(s)}return e},[])}_getAssociationKeys(e=this){const t=r.keys(e.has),n=r.keys(e.belongs);return{has:t,belongs:n,includes:e=>[...t,...n].includes(e)}}}},function(e,t){e.exports=Object({WEBPACK_ENV:!0}).WEBPACK?function(){}:console.log},function(e,t,n){n(3),n(4);e.exports=function(){Array.from(arguments).map(e=>"object"==typeof e?JSON.stringify(e,null,2):e).join(" ")}},function(e,t){var n,r,o=e.exports={};function s(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function a(e){if(n===setTimeout)return setTimeout(e,0);if((n===s||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:s}catch(e){n=s}try{r="function"==typeof clearTimeout?clearTimeout:i}catch(e){r=i}}();var c,l=[],u=!1,h=-1;function p(){u&&c&&(u=!1,c.length?l=c.concat(l):h=-1,l.length&&f())}function f(){if(!u){var e=a(p);u=!0;for(var t=l.length;t;){for(c=l,l=[];++h<t;)c&&c[h].run();h=-1,t=l.length}c=null,u=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===i||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function g(e,t){this.fun=e,this.array=t}function d(){}o.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];l.push(new g(e,t)),1!==l.length||u||a(f)},g.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=d,o.addListener=d,o.once=d,o.off=d,o.removeListener=d,o.removeAllListeners=d,o.emit=d,o.prependListener=d,o.prependOnceListener=d,o.listeners=function(e){return[]},o.binding=function(e){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},function(e,t,n){"use strict";var r=/[|\\{}()[\]^$+*?.]/g;e.exports=function(e){if("string"!=typeof e)throw new TypeError("Expected a string");return e.replace(r,"\\$&")}},function(e,t,n){"use strict";(function(e){const t=n(42),r=(e,n)=>(function(){return`[${e.apply(t,arguments)+n}m`}),o=(e,n)=>(function(){const r=e.apply(t,arguments);return`[${38+n};5;${r}m`}),s=(e,n)=>(function(){const r=e.apply(t,arguments);return`[${38+n};2;${r[0]};${r[1]};${r[2]}m`});Object.defineProperty(e,"exports",{enumerable:!0,get:function(){const e=new Map,n={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],gray:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};n.color.grey=n.color.gray;for(const t of Object.keys(n)){const r=n[t];for(const t of Object.keys(r)){const o=r[t];n[t]={open:`[${o[0]}m`,close:`[${o[1]}m`},r[t]=n[t],e.set(o[0],o[1])}Object.defineProperty(n,t,{value:r,enumerable:!1}),Object.defineProperty(n,"codes",{value:e,enumerable:!1})}const i=e=>e,a=(e,t,n)=>[e,t,n];n.color.close="[39m",n.bgColor.close="[49m",n.color.ansi={ansi:r(i,0)},n.color.ansi256={ansi256:o(i,0)},n.color.ansi16m={rgb:s(a,0)},n.bgColor.ansi={ansi:r(i,10)},n.bgColor.ansi256={ansi256:o(i,10)},n.bgColor.ansi16m={rgb:s(a,10)};for(let e of Object.keys(t)){if("object"!=typeof t[e])continue;const i=t[e];"ansi16"===e&&(e="ansi"),"ansi16"in i&&(n.color.ansi[e]=r(i.ansi16,0),n.bgColor.ansi[e]=r(i.ansi16,10)),"ansi256"in i&&(n.color.ansi256[e]=o(i.ansi256,0),n.bgColor.ansi256[e]=o(i.ansi256,10)),"rgb"in i&&(n.color.ansi16m[e]=s(i.rgb,0),n.bgColor.ansi16m[e]=s(i.rgb,10))}return n}})}).call(this,n(41)(e))},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,n){var r=n(11),o=n(44),s={};Object.keys(r).forEach(function(e){s[e]={},Object.defineProperty(s[e],"channels",{value:r[e].channels}),Object.defineProperty(s[e],"labels",{value:r[e].labels});var t=o(e);Object.keys(t).forEach(function(n){var r=t[n];s[e][n]=function(e){var t=function(t){if(null==t)return t;arguments.length>1&&(t=Array.prototype.slice.call(arguments));var n=e(t);if("object"==typeof n)for(var r=n.length,o=0;o<r;o++)n[o]=Math.round(n[o]);return n};return"conversion"in e&&(t.conversion=e.conversion),t}(r),s[e][n].raw=function(e){var t=function(t){return null==t?t:(arguments.length>1&&(t=Array.prototype.slice.call(arguments)),e(t))};return"conversion"in e&&(t.conversion=e.conversion),t}(r)})}),e.exports=s},function(e,t,n){"use strict";e.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},function(e,t,n){var r=n(11);function o(e){var t=function(){for(var e={},t=Object.keys(r),n=t.length,o=0;o<n;o++)e[t[o]]={distance:-1,parent:null};return e}(),n=[e];for(t[e].distance=0;n.length;)for(var o=n.pop(),s=Object.keys(r[o]),i=s.length,a=0;a<i;a++){var c=s[a],l=t[c];-1===l.distance&&(l.distance=t[o].distance+1,l.parent=o,n.unshift(c))}return t}function s(e,t){return function(n){return t(e(n))}}function i(e,t){for(var n=[t[e].parent,e],o=r[t[e].parent][e],i=t[e].parent;t[i].parent;)n.unshift(t[i].parent),o=s(r[t[i].parent][i],o),i=t[i].parent;return o.conversion=n,o}e.exports=function(e){for(var t=o(e),n={},r=Object.keys(t),s=r.length,a=0;a<s;a++){var c=r[a];null!==t[c].parent&&(n[c]=i(c,t))}return n}},function(e,t,n){"use strict";e.exports={stdout:!1,stderr:!1}},function(e,t,n){"use strict";const r=/(?:\\(u[a-f\d]{4}|x[a-f\d]{2}|.))|(?:\{(~)?(\w+(?:\([^)]*\))?(?:\.\w+(?:\([^)]*\))?)*)(?:[ \t]|(?=\r?\n)))|(\})|((?:.|[\r\n\f])+?)/gi,o=/(?:^|\.)(\w+)(?:\(([^)]*)\))?/g,s=/^(['"])((?:\\.|(?!\1)[^\\])*)\1$/,i=/\\(u[a-f\d]{4}|x[a-f\d]{2}|.)|([^\\])/gi,a=new Map([["n","\n"],["r","\r"],["t","\t"],["b","\b"],["f","\f"],["v","\v"],["0","\0"],["\\","\\"],["e",""],["a",""]]);function c(e){return"u"===e[0]&&5===e.length||"x"===e[0]&&3===e.length?String.fromCharCode(parseInt(e.slice(1),16)):a.get(e)||e}function l(e,t){const n=[],r=t.trim().split(/\s*,\s*/g);let o;for(const t of r)if(isNaN(t)){if(!(o=t.match(s)))throw new Error(`Invalid Chalk template style argument: ${t} (in style '${e}')`);n.push(o[2].replace(i,(e,t,n)=>t?c(t):n))}else n.push(Number(t));return n}function u(e){o.lastIndex=0;const t=[];let n;for(;null!==(n=o.exec(e));){const e=n[1];if(n[2]){const r=l(e,n[2]);t.push([e].concat(r))}else t.push([e])}return t}function h(e,t){const n={};for(const e of t)for(const t of e.styles)n[t[0]]=e.inverse?null:t.slice(1);let r=e;for(const e of Object.keys(n))if(Array.isArray(n[e])){if(!(e in r))throw new Error(`Unknown Chalk style: ${e}`);r=n[e].length>0?r[e].apply(r,n[e]):r[e]}return r}e.exports=((e,t)=>{const n=[],o=[];let s=[];if(t.replace(r,(t,r,i,a,l,p)=>{if(r)s.push(c(r));else if(a){const t=s.join("");s=[],o.push(0===n.length?t:h(e,n)(t)),n.push({inverse:i,styles:u(a)})}else if(l){if(0===n.length)throw new Error("Found extraneous } in Chalk template literal");o.push(h(e,n)(s.join(""))),s=[],n.pop()}else s.push(p)}),o.push(s.join("")),n.length>0){const e=`Chalk template literal is missing ${n.length} closing bracket${1===n.length?"":"s"} (\`}\`)`;throw new Error(e)}return o.join("")})},function(e,t){e.exports=3},function(e,t,n){n(3),n(4);e.exports=function(){Array.from(arguments).map(e=>"object"==typeof e?JSON.stringify(e,null,2):e).join(" ")}},function(e,t,n){n(3),n(4);e.exports=function(){Array.from(arguments).map(e=>"object"==typeof e?JSON.stringify(e,null,2):e).join(" ")}},function(e,t,n){n(3),n(4);e.exports=function(){Array.from(arguments).map(e=>"object"==typeof e?JSON.stringify(e,null,2):e).join(" ")}},function(e,t,n){n(3),n(4);e.exports=function(){Array.from(arguments).map(e=>"object"==typeof e?JSON.stringify(e,null,2):e).join(" ")}},function(e,t,n){const r=n(0),o=(n(1),n(8)),{DEFAULT_ASSOCIATION_JOIN_TYPE:s}=o;e.exports=class{constructor(e={}){r.xtend(this,{schemaFrom:e.schemaFrom,schemaTo:e.schemaTo,sourceHash:e.sourceHash,sourceTable:e.sourceTable,sourceKey:e.sourceKey,targetHash:e.targetHash,targetTable:e.targetTable,targetKey:e.targetKey,foreignTable:e.foreignTable,foreignKey:e.foreignKey,associationType:e.associationType,objectType:e.objectType,type:e.type||s,using:e.using||[],useSourceKey:e.useSourceKey,useTargetKey:e.useTargetKey})}resolveJoinType(){return this.type.toUpperCase()}}},function(e,t,n){n(1);const r=n(0),o=n(54),s=n(57),i=n(58),a=n(59),c=n(60),l=n(61),u=n(62),h=n(63);e.exports=class{constructor(e,t,n){this.name=e,this.rawGraph=t,this.schemaProvider=n,this.graph=this._resolveGraph(this.rawGraph),this.rowsParser=new i(this.graph)}_resolveGraph(e){let t=new o;const n=this.schemaProvider;return r.jtree(e,(e,r,o)=>{if(/^\$$/.test(r)||/(?<=\.(where|shows)\.)\w+$/.test(r)||/(?<=\.options)/.test(r)||/(using|throught|shows|options|alias|properties|\d|where|groupBy|size|page|orderBy|type)$/.test(r))return;const i=e.alias||f(r),p=n(i);if(!p)throw new Error(`Could not detect schema configuration for "${i}".`);function f(e){return e.split(".").pop()}const g=function(e){return 1===e.match(/\./g).length?null:e.match(/(\w+)\.\w+$/)[1]}(r),d=o.parent,b=!!d;if(b&&!p.haveAssociationWith(d))throw new Error(`"${p.name}" have no relation with "${g}".`);const y=new s({name:p.name,alias:e.alias&&f(r),hash:p.hash,tableName:p.tableName,properties:e.properties,schemaProperties:p.properties,primaryKey:p.primaryKey,options:e.where,shows:e.shows,staticOptions:{page:e.page,size:e.size,orderBy:e.orderBy,groupBy:e.groupBy},parentAssociation:function(e,t){return b?e.getAssociationOptionsWith(t):null}(p,d)}),m=t.addNode(p.hash,y,o.lastNodeHash);return m.createResolver("main",a,!0),m.createResolver("filterId",u,!1,""),m.createResolver("options",c),m.createResolver("groupId",l),m.createResolver("count",h),{lastNodeHash:p.hash,lastNodeName:p.name,parent:p}}),t}buildQuery(e={}){return this.graph.resolve("main",r.pickBy(e))}buildCountQuery(e={}){return this.graph.resolve("count",r.pickBy(e))}parseRows(e){return this.rowsParser.parse(e)}}},function(e,t,n){n(0),n(1);const r=n(55);e.exports=class{constructor(){this.head=null,this.tail=null,this.graph={}}addNode(e,t,n,o){return this.head=this.head||e,t=new r({nodeHash:e,resolvers:o,node:t}),this.graph[e]=t,this.tail&&(t.setPreviousNode(this.getNode(n||this.tail)),this.getNode(n||this.tail).addNextNode(t)),this.tail=e,t}getNode(e){return this.graph[e]}getRawNode(e){return this.graph[e].raw()}getHeadNode(){return this.graph[this.getHeadNodeHash()]}getTailNode(){return this.graph[this.getTailNodeHash()]}getHeadNodeHash(){return this.head}getTailNodeHash(){return this.tail}resolve(e,t){return this.getHeadNode().resolve(e,t)}walk(e){return this.getHeadNode().walk(e)}}},function(e,t,n){const r=n(0),o=(n(1),n(56));e.exports=class{constructor(e){this.prevNode=null,this.nextNodes=[],this.node=e.node,this.resolvers={}}getParent(){return this.prevNode?this.prevNode():null}setPreviousNode(e){return this.prevNode=e}addNextNode(e){return this.nextNodes.push(e)}resolve(e,t,n){if(!this.resolvers[e])throw new Error(`Undefined resolver "${e}".`);return this.resolvers[e].resolve(this,t,n)}raw(){return this.node}createResolver(e,t,n,r){this.resolvers[e]=new o(e,t,n,r)}walk(e){e(this.raw()),this.nextNodes.length&&this.nextNodes.forEach(t=>{r.isFunction(t.walk)&&t.walk(e)})}}},function(e,t,n){const r=n(0);n(1);e.exports=class{constructor(e,t,n=!1,r="json_object()"){this.name=e,this.resolver=t,this.usePatch=n,this.defaultValue=r}resolve(e,t,n){return this.resolver(e.raw(),t,this.resolveNextNodes.bind(this,e,t,e.raw()),e.resolve.bind(e),n)}resolveNextNodes(e,t,n){let o=e.nextNodes;const s=this.usePatch,i=this.defaultValue;if(!o.length)return this.defaultValue;let a=(o=r.pair(o,!1,i)).map(e=>e.map(e=>r.isFunction(e.resolve)?e.resolve(this.name,t,n):e));return a=s?(a=a.map(e=>(e=e.map(e=>/^\(/.test(e)||/\)$/.test(e)?e:`(${e})`)).length>1?`/* begin json_patch #3 */ json_patch(${e.join(",")}) /* end json_patch #3 */`:e[0])).length>1?`/* begin json_patch #4 */ json_patch(${a}) /* end json_patch #4 */`:a[0]:a.map(e=>e.join(" ")).join(" ")}}},function(e,t,n){const r=n(0),o=(n(1),n(8)),{DEFAULT_OBJECT_TYPE:s,DEFAULT_PAGE_DATA_LIMIT:i,DEFAULT_ROW_NAME:a}=o;e.exports=class{constructor(e={}){r.xtend(this,{name:e.name,alias:e.alias,hash:e.hash,properties:e.properties,schemaProperties:r.defaults(e.schemaProperties,[]),definedProperties:this._resolvePropertiesDefinition(e.schemaProperties,e.properties),tableName:e.tableName,primaryKey:e.primaryKey,parentAssociation:e.parentAssociation,definedOptions:r.defaults(e.options,{}),staticOptions:e.staticOptions,nodeOptions:r.defaults(e.shows,{})})}_resolvePropertiesDefinition(e,t){function n(e,t){return t.find(t=>t.name===e)}return!t||r.isString(t)?e:t.filter(t=>n(t,e)).map(t=>n(t,e))}getTableName(){return this.tableName}getTableAlias(){return this.hash}getObjectType(){return this.parentAssociation?this.parentAssociation.objectType:s}getPrimaryKey(){return this.primaryKey}getFieldsAsJson(){const e=this.getTableAlias();return this.definedProperties.filter(e=>!this.parentAssociation||"primaryKey"!==e.type).map(t=>{let n,o="primaryKey"===t.type?"_id":t.name;switch(n=t.resolver?"(CASE"+t.resolver.map(t=>` WHEN ${e}.${t} IS NOT NULL THEN ${e}.${t}`).join(" ")+" END)":t.join?t.join.join(" || "):e.concat(".").concat(t.alias||t.name),t.type){case"boolean":n=`(CASE WHEN ${n} IS NOT NULL AND ${n}<>0 THEN 1 ELSE 0 END)`;break;case"integer":n=`cast(${n} as integer)`;break;case"number":n=`cast(${n} as real)`}return[r.quote(o),n].join(",")}).join(",")}getResponseObjectName(){return this.parentAssociation?"":a}getRawFields(){return"*"}getSource(e){const t=this.parentAssociation;return!t||e||!r.isObject(t)&&1!==t.length?`FROM ${this.getTableName()} ${this.getAssociation(e)}`:`FROM ${this.getAssociation(e)}`}getAssociation(e=!1){let t=this.parentAssociation;return t?(t=r.toArray(t)).map((t,n,r)=>{const o=n===r.length-1,s=t.resolveJoinType(),i=!!t.foreignTable&&!!t.foreignKey,{sourceTable:a,sourceKey:c,sourceHash:l,targetTable:u,targetKey:h,targetHash:p,foreignTable:f,foreignKey:g,useTargetKey:d,useSourceKey:b,associationType:y}=t,m=/^belongs/.test(y)?p:l;return 1!==r.length||e?e?`/* begin breakpoint #1 */, json_each(${m}.id_${c}) WHERE ${a}.${c}=json_each.value /* end breakpoint #1 */`:o?i?"/* begin breakpoint #4 (missing) */ /* end breakpoint #4 (missing) */":`/* begin breakpoint #5 */ WHERE ${u}.${h}=${n?a:m}.${b||h} /* end breakpoint #5 */`:i?`/* begin breakpoint #2 */ ${s} JOIN ${f} ON ${f}.${g}=${l}.${g}\n            ${s} JOIN ${u} ON ${u}.${h}=${f}.${h} /* end breakpoint #2 */`:`/* begin breakpoint #3 */ ${s} JOIN ${u} ON ${u}.${d||h}=${l}.${b||c} /* end breakpoint #3 */`:`/* begin breakpoint #8 */ (SELECT ${l}.${b||c}) AS ${l} ${s} JOIN ${u} ${p} ON ${p}.${d||h}=${l}.${b||c} /* end breakpoint #8 */`}).join(" "):""}getJoin(e){let t=this.parentAssociation;return t?(t=r.toArray(t)).map(t=>{const n=t.resolveJoinType(),{sourceTable:r,sourceKey:o,useSourceKey:s,sourceHash:i,targetTable:a,targetKey:c,useTargetKey:l,targetHash:u,foreignTable:h,foreignKey:p,associationType:f}=t;return!e||/^left/i.test(n)||/^belongs/.test(f)?"":h&&p?`/* begin breakpoint #6 */ ${n} JOIN ${h} ON ${h}.${p}=${r}.${p} ${n} JOIN ${a} ON ${a}.${c}=${h}.${c} /* end breakpoint #6 */`:`/* begin breakpoint #7 */ ${n} JOIN ${a} ON ${a}.${l||c}=${r}.${s||o} /* end breakpoint #7 */`}).join(" "):""}getShowOptions(e){return(e=this.resolveOptionsWithValues(this.nodeOptions,e)).length?`AND ${e.join(" AND ")}`:""}getOptions(e={},t=[]){const n=this,o=this.resolveOptionsWithValues(this.definedOptions,e),s=r.toArray(this.staticOptions.groupBy),a=r.toArray(this.staticOptions.orderBy),c=e.page||this.staticOptions.page,l=e.size||this.staticOptions.size,u={where:function(e){return e&&e.length?" WHERE ".concat(e.join(" AND ")):""}(o),group:(h=s,h&&h.length?" GROUP BY "+h.map(e=>{const t=n.getSchemaPropertyConfig(e);if(!t)throw new Error(`Undefined "${e}" property configuration on "${n.name}" schema for grouping.`);return t.alias||t.name}).map(e=>n.getTableName().concat(".").concat(e)):""),order:function(e){return e&&e.length?" ORDER BY "+e.map(e=>{const t=n.getSchemaPropertyConfig(e);if(!t)throw new Error(`Undefined "${e}" property configuration on "${n.name}" schema for ordering.`);return t.alias||t.name}).map(e=>n.getTableName().concat(".").concat(e)):""}(a),limit:function(e){const t=n.staticOptions.size;return n.parentAssociation&&t?`LIMIT ${t}`:n.parentAssociation?"":e?`LIMIT ${e}`:`LIMIT ${i}`}(e.size),offset:function(e,t){return!n.parentAssociation&&e&&t?" OFFSET ".concat((e-1)*t):""}(c,l)};var h;return t.length?t.map(e=>u[e]).join(" "):r.keys(u).map(e=>u[e]).join(" ")}resolveOptionsWithValues(e,t){const n=r.keys(t).filter(t=>!!e.hasOwnProperty(t));return n.length?n.map(n=>{const o=e[n].replace(/\W/g,""),s=this.schemaProperties.find(e=>e.name===o),i=e[n],a=t[n],c=s.alias||s.name,l=/\W/.test(i)?i.match(/\W/)[0]:"=";if(!s)throw new Error(`"${o}" property from where clause not found in "${this.name}" schema properties.`);return{name:c,definition:i,value:a,operator:l,resolve:function(){const e=this.operator,t=this.value;switch(e){case"=":return`=${r.quote(t)}`;case"<>":return`<>${r.quote(t)}`;case">":return`>${t}`;case"<":return`<${t}`;case"%":return`LIKE ${r.quote("%"+t+"%")}`;case"#":return`GLOB ${r.quote(r.glob(t))}`;case"|":case"&":default:return""}}}}).map(e=>`${this.getTableName()}.${e.name} ${e.resolve()}`):""}getSchemaPropertyConfig(e){return this.schemaProperties.find(t=>t.name===e)}getAssociationName(){return r.quote(this.name)}getDistinctPrimaryKey(){return`DISTINCT ${this.getTableName()}.${this.getPrimaryKey()}`}haveGroupByOption(){return!!this.staticOptions.groupBy}}},function(e,t,n){const r=n(0);n(1);e.exports=class{constructor(e){this.shadow=this.createShadowFromGraph(e)}createShadowFromGraph(e){let t,n={};return e.walk(e=>{const c=e.parentAssociation,l=c?c.objectType:"object";t=t?"array"===l?t.concat(".").concat(e.name):t:"$","array"===l&&(n[t]=o.bind(this,[a])),e.definedProperties.filter(e=>"primaryKey"!==e.type||!c).map(e=>{const n=[],a="primaryKey"===e.type?"_id":e.name;switch(e.type){case"boolean":n.push(i);break;case"number":n.push(s)}r.isFunction(e.parser)&&n.push(e.parser);const c=t.concat(".").concat(a);return n.length?{[c]:o.bind(this,n)}:{}}).forEach(e=>{n=r.xtend(n,e)})}),n}parse(e){const t=this.shadow;return e.map(e=>(r.keys(t).forEach(n=>{const o=n.replace(/^\$\./,""),s=r.get(e,o);r.isDef(s)&&r.set(e,o,t[n](s))}),e))}};const o=function(e,t){return e&&e.length?(e.forEach(e=>t=e(t)),t):t};function s(e){return parseInt(e)}function i(e){return!!e}function a(e){return r.isArray(e)?e.filter(e=>e):e}},function(e,t,n){const r=n(0);n(1);e.exports=function(e,t={},n,o,s){const i=e.getObjectType(),a=!!e.parentAssociation;let c=e.getOptions(t,["group","order","limit","offset"]);a||(c=c.replace(/LIMIT\s\d+/,"").replace(/OFFSET\s\d+/,""));const l=n(t);let u,h=(u=/object/.test(i)?a&&/^json_object\(\)$/.test(l)?"select json_object($fields_as_json) $object_name $grouped_ids $source $show_options $options":"select /* begin json_patch #1 */ json_patch(json_object($fields_as_json), ($next_nodes)) /* end json_patch #1 */ $object_name from (select $raw_fields $grouped_ids $source $show_options $options) $table_alias":a&&/^json_object\(\)$/.test(l)?"(select json_object($node_name, (select json_group_array(json_object($fields_as_json)) from (select $raw_fields $grouped_ids $source $show_options $options) $table_alias)))":"(select json_object($node_name, (select json_group_array(/* begin json_patch #2 */json_patch(json_object($fields_as_json), ($next_nodes))/* end json_patch #2 */) from (select $raw_fields $grouped_ids $source $show_options $options) $table_alias)))").replace(/\$table_alias/,e.getTableAlias()).replace(/\$raw_fields/,e.getRawFields()).replace(/\$grouped_ids/,a?o("groupId"):"").replace(/\$source/,e.getSource(s&&s.haveGroupByOption())).replace(/\$fields_as_json/,e.getFieldsAsJson()).replace(/\$object_name/,e.getResponseObjectName()).replace(/\$node_name/,e.getAssociationName()).replace(/\$next_nodes/,l).replace(/\$show_options/,e.getShowOptions(t)).replace(/\$options/,c);if(!a){const n=o("filterId",t);h+=` WHERE ${e.getTableAlias()}.${e.getPrimaryKey()} IN (${n})`,h+=` AND ${e.getResponseObjectName()} IS NOT NULL;`}return h=r.query(h),a||r.pbcopy(h),h}},function(e,t){e.exports=function(e,t,n){return e.getOptions(t,["where"])+n(t)}},function(e,t,n){const r=n(0);n(1);e.exports=function(e,t,n,o){return e.parentAssociation&&e.haveGroupByOption()?r.toArray(e.parentAssociation).filter((e,t,n)=>t===n.findIndex(t=>e.targetTable===t.targetTable&&e.targetKey===t.targetKey)).map(e=>`, json_group_array(${e.targetTable}.${e.targetKey}) AS id_${e.targetKey}`).join(",").replace(/\,\,/g,",").replace(/\,$/,""):""}},function(e,t,n){n(0),n(1);e.exports=function(e,t,n,r){const o=n().replace(/json_object\(\)/g,"");let s=r("options",t).replace(/json_object\(\)/g,"");const i=e.getOptions(t,["group","order","limit","offset"]),a=!!s&&!/^\s{0,}$/.test(s);return a&&/WHERE/.test(s)&&s.match(/WHERE/g).length>1&&(s=s.trim().replace(/(?!^)(WHERE)/g," AND ")),e.parentAssociation?`${e.getJoin(a)} ${o}`:`SELECT ${e.getDistinctPrimaryKey()} ${e.getSource()} ${o} ${s} ${i}`}},function(e,t,n){const r=n(0);n(1);e.exports=function(e,t,n,o){let s="";const i=n().replace(/json_object\(\)/g,""),a=e.getOptions(t,["group","order","limit","offset"]);let c=o("options",t).replace(/json_object\(\)/g,"");return s=e.parentAssociation?`${e.getJoin()} ${i}`:`SELECT COUNT(${e.getDistinctPrimaryKey()}) AS count ${e.getSource()} ${i} ${c} ${a}`,e.parentAssociation||(s=r.query(s)),s}}])});
//# sourceMappingURL=graphlite.js.map